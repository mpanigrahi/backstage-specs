# Pipeline details across environments (defaults)
common:
  pipelineType: app-dev
  debug: true

  npm:
    dockerImage: 'jnj.artifactrepo.jnj.com/jpm/node:14'

  unitTest:
    enabled: true
    type: multi
    stages:
      query-engine:
        enabled: true
        type: npm
        dir: "project/rdx-conversion-uom-api"
        npmCommand: "npm run coverage"

  lint:
    enabled: true
    type: "multi"
    stages:
       query-engine:
         enabled: true
         type: npm
         dir: "project/rdx-conversion-uom-api"

  staticAnalysis:
    enabled: true
    type: sonar
    shortLivedAnalysis: true
    longLivedAnalysis: true

  versionCalculation:
    enabled: true
    type: gitversion
    patternType: jnj-developer-branch

  package:
    enabled: true
    type: helm
    versionFileUpdates: 
      - type: yaml
        file: _scm_helm/Chart.yaml
        path: version
      - type: yaml
        file: _scm_helm/Chart.yaml
        path: appVersion
      - type: yaml
        file: _scm_helm/values.yaml
        path: image.tag
        
  publish:
    enabled: false
    type: "multi"
    stages:
      Helm:
        enabled: true
        type: helm
        chartRepo: taww-helm-charts
      Docker:
        enabled: true
        type: docker
        updateToVersion: false
        credsList:
          - registry: https://jnj.artifactrepo.jnj.com
            credentialsId: sourcecode-bitbucket

  buildAnalysis:
    enabled: false

  deploy:
    enabled: false
    type: helm
    name: rdx-conversion-uom-api
    namespace: rdx-apps-pdrm
    chartRepoCredentialsId: "sourcecode-bitbucket"    
    kubernetesConfig:
      type: aks
      name: azr-arb-rdxcluster-development
      directoryId: 3ac94b33-9135-4821-9502-eafda6592a35
      resourceGroup: AZR-ARB-Rdxcluster-Development
      region: west europe
      credentialsId: "itx-agq-eatjenkinsadminapi"
      kubelogin: true
    atomic: true
  
  resolveArtifacts:
    enabled: false

environments:
  PREDEV:
    versionCalculation:
      patternType: jnj-developer-branch
    unitTest:
      enabled: true
    lint:
      enabled: true
    staticAnalysis:
      shortLivedAnalysis: true
    package:
      enabled: true
    publish:
      enabled: false
      stages:
        Docker:
          tagStrategy: predev
    deploy:
      enabled: false

  DEV:
    versionCalculation:
      patternType: jnj-dev-branch
    unitTest:
      enabled: false
    lint:
      enabled: false
    staticAnalysis:
      longLivedAnalysis: false
    package:
      enabled: true
    publish:
      enabled: true
      stages:
        Docker:
          tagStrategy: dev
          prerelease:
            tagStrategy: prerelease
          release:
            tagStrategy: release
    deploy:
      enabled: true
      type: helm
      name: pdi-query-api
      namespace: pdi-app
      chartRepoCredentialsId: "sourcecode-bitbucket"  
      configFiles:
      - repoBranch: develop
        repoCredentialsId: "sourcecode-bitbucket"      
      kubernetesConfig:
        type: aks
        name: azr-arb-rdxcluster-development
        directoryId: 3ac94b33-9135-4821-9502-eafda6592a35
        resourceGroup: AZR-ARB-Rdxcluster-Development
        region: west europe
        credentialsId: "itx-agq-eatjenkinsadminapi"
        kubelogin: true
      atomic: true            
            
  PROD:
    versionCalculation:
      type: helm
      confirmVersion: true
      version: "^0"
    resolveArtifacts:
      enabled: true
      type: helm
    deploy:
      enabled: false
      type: helm
      name: rdx-conversion-uom-api
      namespace: pdi-app
      chartRepoCredentialsId: "sourcecode-bitbucket"  
      configFiles:
      - repoBranch: main
        repoCredentialsId: "sourcecode-bitbucket"      
      kubernetesConfig:
        type: aks
        name: azr-arb-rdxcluster-development
        directoryId: 3ac94b33-9135-4821-9502-eafda6592a35
        resourceGroup: AZR-ARB-Rdxcluster-Development
        region: west europe
        credentialsId: "itx-agq-eatjenkinsadminapi"
        kubelogin: true
      atomic: true 